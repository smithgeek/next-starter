fragment Feature on features {
	feature_id
	options
	expiration
}

fragment UserFeatures on users {
	tenants(where: { tenant_id: { _eq: $tenantId } }) {
		tenant {
			features(where: { feature: { _or: [{ expiration: { _is_null: true } }, { expiration: { _gt: "now()" } }] } }) {
				feature {
					...Feature
				}
			}
		}
		user_tenant_features(where: { feature: { _or: [{ expiration: { _is_null: true } }, { expiration: { _gt: "now()" } }] } }) {
			feature {
				...Feature
			}
		}
	}
	features(where: { feature: { _or: [{ expiration: { _is_null: true } }, { expiration: { _gt: "now()" } }] } }) {
		feature {
			...Feature
		}
	}
}

query GetUserFeatures($userId: uuid!, $tenantId: uuid!) {
	users_by_pk(id: $userId) {
		...UserFeatures
	}
}
